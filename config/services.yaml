services:
  _defaults:
    autowire: true
    autoconfigure: true

  ############
  # Commands #
  ############
  Neusta\Pimcore\ImportExportBundle\Command\ExportAssetsCommand:
    arguments:
      $repository: '@Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\AssetRepository'
      $exporter: '@Neusta\Pimcore\ImportExportBundle\Export\Exporter'
    tags: [ 'console.command' ]

  Neusta\Pimcore\ImportExportBundle\Command\ExportDocumentsCommand:
    arguments:
      $repository: '@Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\DocumentRepository'
      $exporter: '@Neusta\Pimcore\ImportExportBundle\Export\Exporter'
    tags: [ 'console.command' ]

  Neusta\Pimcore\ImportExportBundle\Command\ExportDataObjectsCommand:
    arguments:
      $repository: '@Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\DataObjectRepository'
      $exporter: '@Neusta\Pimcore\ImportExportBundle\Export\Exporter'
    tags: [ 'console.command' ]

  Neusta\Pimcore\ImportExportBundle\Command\ImportAssetsCommand:
    arguments:
      $extractPath: sys_get_temp_dir() . '/pimcore_assets_import'
      $importer: '@Neusta\Pimcore\ImportExportBundle\Import\Importer'
    tags: [ 'console.command' ]

  Neusta\Pimcore\ImportExportBundle\Command\ImportDataObjectsCommand:
    arguments:
      $importer: '@Neusta\Pimcore\ImportExportBundle\Import\Importer'
    tags: [ 'console.command' ]

  Neusta\Pimcore\ImportExportBundle\Command\ImportDocumentsCommand:
    arguments:
      $importer: '@Neusta\Pimcore\ImportExportBundle\Import\Importer'
    tags: [ 'console.command' ]

  ##############
  # Controller #
  ##############
  Neusta\Pimcore\ImportExportBundle\Controller\Admin\ExportAssetsController:
    public: true
    tags: [ 'controller.service_arguments' ]

  Neusta\Pimcore\ImportExportBundle\Controller\Admin\ExportDataObjectsController:
    public: true
    tags: [ 'controller.service_arguments' ]

  Neusta\Pimcore\ImportExportBundle\Controller\Admin\ExportDocumentsController:
    public: true
    tags: [ 'controller.service_arguments' ]

  Neusta\Pimcore\ImportExportBundle\Controller\Admin\ImportAssetsController:
    public: true
    tags: [ 'controller.service_arguments' ]

  Neusta\Pimcore\ImportExportBundle\Controller\Admin\ImportDocumentsController:
    public: true
    tags: [ 'controller.service_arguments' ]

  Neusta\Pimcore\ImportExportBundle\Controller\Admin\ImportDataObjectsController:
    public: true
    tags: [ 'controller.service_arguments' ]

  ############
  # Importer #
  ############
  Neusta\Pimcore\ImportExportBundle\Import\Importer:
    class: Neusta\Pimcore\ImportExportBundle\Import\Importer
    arguments:
      $repositoryLocator: !tagged_locator { tag: 'neusta.import_export.repository', index_by: 'type' }
      $converterLocator: !tagged_locator { tag: 'neusta.import_export.converter', index_by: 'type' }
      $mergeStrategyLocator: !tagged_locator { tag: 'neusta.import_export.merge_strategy', index_by: 'type' }
      $parentRelationResolver: '@Neusta\Pimcore\ImportExportBundle\Import\ParentRelationResolver'
      $serializer: '@Neusta\Pimcore\ImportExportBundle\Serializer\SerializerStrategy'

  Neusta\Pimcore\ImportExportBundle\Import\ZipImporter: ~

  ############
  # Exporter #
  ############
  Neusta\Pimcore\ImportExportBundle\Export\Exporter:
    class: Neusta\Pimcore\ImportExportBundle\Export\Exporter
    arguments:
      $typeToConverterMap:
        Pimcore\Model\Asset: '@neusta_pimcore_import_export.strategy.export_asset'
        Pimcore\Model\Document\Page: '@neusta_pimcore_import_export.strategy.export_document'
        Pimcore\Model\Document\Snippet: '@neusta_pimcore_import_export.strategy.export_document'
        Pimcore\Model\Document: '@neusta_pimcore_import_export.strategy.export_document'
        Pimcore\Model\DataObject: '@neusta_pimcore_import_export.export_object'
      $serializer: '@Neusta\Pimcore\ImportExportBundle\Serializer\SerializerStrategy'

  ##################
  # Merge Strategy #
  ##################
  Neusta\Pimcore\ImportExportBundle\Import\Strategy\Document\UpdateExistingPageStrategy:
    tags:
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Document' }
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Document\Folder' }
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Document\Page' }
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Document\Snippet' }

  Neusta\Pimcore\ImportExportBundle\Import\Strategy\ReplaceExistingElementStrategy:
    tags:
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Asset' }
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Concrete' }

  ##############
  # Service    #
  ##############
  Neusta\Pimcore\ImportExportBundle\Export\Service\ZipService: ~

  Neusta\Pimcore\ImportExportBundle\Import\ParentRelationResolver: ~

  Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\AssetRepository:
    public: true
    tags:
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Asset' }

  Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\DataObjectRepository:
    public: true
    tags:
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Concrete' }

  Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\DocumentRepository:
    public: true
    tags:
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Document' }
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Document\Folder' }
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Document\Page' }
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Document\Snippet' }


  ##############
  # Serializer #
  ##############
  Neusta\Pimcore\ImportExportBundle\Serializer\SerializerInterface:
    alias: Neusta\Pimcore\ImportExportBundle\Serializer\SerializerStrategy

  Neusta\Pimcore\ImportExportBundle\Serializer\SerializerStrategy:
    arguments:
      $formatToSerializerMap:
        yaml: '@Neusta\Pimcore\ImportExportBundle\Serializer\YamlSerializer'
        json: '@Neusta\Pimcore\ImportExportBundle\Serializer\JsonSerializer'

  Neusta\Pimcore\ImportExportBundle\Serializer\YamlSerializer: ~
  Neusta\Pimcore\ImportExportBundle\Serializer\JsonSerializer: ~

  Neusta\Pimcore\ImportExportBundle\Serializer\Normalizer\PrioritizedAttributesNormalizer:
    arguments:
      $priorities:
        - 'type'
        - 'id'
        - 'parentId'
        - 'path'
        - 'key'
        - 'published'
        - 'controller'
        - 'language'
        - 'navigation_name'
        - 'navigation_title'
        - 'title'
        - 'editables'
        - 'filename'
    tags: [ 'serializer.normalizer' ]

  #################
  # EventListener #
  #################
  Neusta\Pimcore\ImportExportBundle\EventListener\PimcoreAdminListener:
    tags:
      - { name: kernel.event_listener, event: pimcore.bundle_manager.paths.js, method: addJSFiles }

  Neusta\Pimcore\ImportExportBundle\Import\EventSubscriber\ImportLoggingEventSubscriber: ~
  Neusta\Pimcore\ImportExportBundle\Import\EventSubscriber\StatisticsEventSubscriber: ~
