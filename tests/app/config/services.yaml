imports:
  - { resource: '../../../config/services.yaml' }

services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: true

  Neusta\Pimcore\ImportExportBundle\Toolbox\:
    resource: '../../../src/Toolbox'

  Neusta\Pimcore\ImportExportBundle\Tests\Integration\Documents\ImportExportYamlDriver: ~

  ############
  # Exporter #
  ############
  Neusta\Pimcore\ImportExportBundle\Export\Exporter:
    class: Neusta\Pimcore\ImportExportBundle\Export\Exporter
    arguments:
      $typeToConverterMap:
        Pimcore\Model\Asset\Image: '@neusta_pimcore_import_export.export_asset_image'
        Pimcore\Model\Document\Page: '@neusta_pimcore_import_export.export_page'
        Pimcore\Model\Document\PageSnippet: '@neusta_pimcore_import_export.export_page_snippet'
        Pimcore\Model\Document\Folder: '@neusta_pimcore_import_export.export_folder'
        Pimcore\Model\Concrete: '@neusta_pimcore_import_export.export_object'
      $serializer: '@Neusta\Pimcore\ImportExportBundle\Serializer\SerializerStrategy'

  ############
  # Importer #
  ############
  Neusta\Pimcore\ImportExportBundle\Import\Importer:
    class: Neusta\Pimcore\ImportExportBundle\Import\Importer
    arguments:
      $repositoryLocator: !tagged_locator { tag: 'neusta.import_export.repository', index_by: 'type' }
      $converterLocator: !tagged_locator { tag: 'neusta.import_export.converter', index_by: 'type' }
      $mergeStrategyLocator: !tagged_locator { tag: 'neusta.import_export.merge_strategy', index_by: 'type' }
      $parentRelationResolver: '@Neusta\Pimcore\ImportExportBundle\Import\ParentRelationResolver'
      $serializer: '@Neusta\Pimcore\ImportExportBundle\Serializer\SerializerStrategy'

  Neusta\Pimcore\ImportExportBundle\Import\ParentRelationResolver: ~

  ##################
  # Merge Strategy #
  ##################
  Neusta\Pimcore\ImportExportBundle\Import\Strategy\Page\UpdateExistingPageStrategy:
    tags:
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Document' }
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Document\Page' }
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Document\PageSnippet' }

  Neusta\Pimcore\ImportExportBundle\Import\Strategy\ReplaceElementStrategy:
    tags:
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Asset' }
      - { name: 'neusta.import_export.merge_strategy', type: 'Pimcore\Model\Concrete' }

  Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\AssetRepository:
    tags:
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Asset' }

  Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\DataObjectRepository:
    tags:
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Concrete' }

  Neusta\Pimcore\ImportExportBundle\Toolbox\Repository\DocumentRepository:
    tags:
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Document' }
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Document\Page' }
      - { name: 'neusta.import_export.repository', type: 'Pimcore\Model\Document\PageSnippet' }

